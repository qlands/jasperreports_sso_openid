{"version":3,"sources":["webpack://jrs-ui/../bi-report/src/bi/report/jive/view/BaseJiveComponentView.js","webpack://jrs-ui/../bi-report/src/bi/report/loader/jsonpLoader.js","webpack://jrs-ui/../bi-report/src/bi/report/jive/view/GooglemapComponentView.js","webpack://jrs-ui/../bi-report/src/bi/report/loader/scriptLoader.js"],"names":["localLogger","logger","Backbone","initialize","options","this","stateModel","report","debug","arguments","getReportId","id","setDataReportId","$el","attr","getReportContainer","$","scale","scaleFactor","model","set","render","renderDeferred","resolve","detachEvents","remove","_applyScaleTransform","$container","origin","transform","browserDetection","filter","css","uid","generateUid","loadGoogleMapsPromise","BaseJiveComponentView","$reportEl","infowindow","_init","it","instData","get","reqParams","requestParams","substr","callback","_showMap","latitude","longitude","zoom","mapType","markerList","pathsList","google","maps","url","jsonpCallbackParam","Promise","reject","callbackFunctionName","window","initialUrl","URL","location","href","searchParams","append","loadScript","scriptProps","async","loadJsonp","then","_configureImage","pk","pp","po","width","height","originX","originY","anchorX","anchorY","parseInt","size","Size","Point","anchor","_createInfo","length","gg","content","LatLng","InfoWindow","canvasId","markers","p","myOptions","center","mapTypeId","MapTypeId","autocloseinfo","container","find","map","Map","j","i","markerProps","markerOptions","position","indexOf","hasOwnProperty","marker","Marker","event","addListener","close","open","k","props","o","l","isPoly","prop","loc","m","latln","push","_getBooleanValue","Polygon","Polyline","v","LOAD_TIMEOUT_MILLIS","Number","process","urlCache","cache","prefix","cacheKey","result","script","document","createElement","charset","timeout","Object","keys","forEach","src","onScriptError","onerror","onload","clearTimeout","scriptTimeout","setTimeout","Error","head","appendChild"],"mappings":"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","file":"_chunks/chunk.459.js","sourcesContent":["/*\n * Copyright (C) 2005 - 2022 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.\n * Licensed pursuant to commercial TIBCO End User License Agreement.\n */\n\nimport Backbone from 'backbone';\nimport $ from 'jquery';\nimport browserDetection from 'js-sdk/src/common/util/browserDetection';\n\nimport logger from \"js-sdk/src/common/logging/logger\";\n\nlet localLogger = logger.register(\"BaseJiveComponentView\");\n\nexport default Backbone.View.extend({\n    initialize: function (options) {\n        this.stateModel = options.stateModel;\n        this.report = options.report;\n        localLogger.debug('Create jive view', this);\n        Backbone.View.prototype.initialize.apply(this, arguments);\n    },\n    //protected\n    getReportId: function () {\n        return this.report && this.report.id;\n    },\n    //protected\n    setDataReportId: function ($el, id) {\n        $el.attr('data-reportId', id);\n    },\n    //protected\n    getReportContainer: function (id) {\n        return $('[data-reportId = \\'' + id + '\\']');\n    },\n    //optional\n    scale: function (scaleFactor) {\n        this.model.set('scaleFactor', scaleFactor);\n    },\n    // should be overridden; each implementation should return a deferred object\n    render: function ($el) {\n        var renderDeferred = new $.Deferred();\n        renderDeferred.resolve();\n        return renderDeferred;\n    },\n    // should be overridden, optional\n    detachEvents: function () {\n    },\n    remove: function () {\n        this.detachEvents();\n        Backbone.View.prototype.remove.apply(this, arguments);\n    },\n    _applyScaleTransform: function ($container, scaleFactor) {\n        var scale = 'scale(' + scaleFactor + ')', origin = '0 0', transform = {\n            '-webkit-transform': scale,\n            '-webkit-transform-origin': origin,\n            '-moz-transform': scale,\n            '-moz-transform-origin': origin,\n            '-ms-transform': scale,\n            '-ms-transform-origin': origin,\n            '-o-transform': scale,\n            '-o-transform-origin': origin,\n            'transform': scale,\n            'transform-origin': origin\n        };    // transform: scale, analog for IE8 and lower.\n        // transform: scale, analog for IE8 and lower.\n        if (browserDetection.isIE8()) {\n            transform.filter = 'progid:DXImageTransform.Microsoft.Matrix(M11=' + scaleFactor + ', M12=0, M21=0, M22=' + scaleFactor + ', SizingMethod=\\'auto expand\\')';\n        }\n        $container.css(transform);\n    }\n});","/*\n * Copyright (C) 2005 - 2022 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.\n * Licensed pursuant to commercial TIBCO End User License Agreement.\n */\n\nimport {loadScript} from './scriptLoader';\n\nlet uid = 0;\n\nconst generateUid = () => {\n    uid = uid + 1;\n    return `__async_req_${uid}__`;\n}\n\nexport const loadJsonp = (url, jsonpCallbackParam = 'callback') => {\n    return new Promise((resolve, reject) => {\n        const callbackFunctionName = generateUid();\n        window[callbackFunctionName] = resolve;\n\n        const initialUrl = new URL(url, window.location.href);\n        initialUrl.searchParams.append(jsonpCallbackParam, callbackFunctionName);\n\n        loadScript(initialUrl.href, {scriptProps: {async: true}}).catch(reject);\n    });\n};","/*\n * Copyright (C) 2005 - 2022 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.\n * Licensed pursuant to commercial TIBCO End User License Agreement.\n */\n\n\n/**\n * @author: Narcis Marcu\n * @version: $Id$\n */\n\n/* global google */\n\nimport BaseJiveComponentView from './BaseJiveComponentView';\nimport {loadJsonp} from '../../loader/jsonpLoader';\n\nlet loadGoogleMapsPromise = null;\n\nexport default BaseJiveComponentView.extend({\n    render: function ($el) {\n        this.$reportEl = $el;\n        this.infowindow = {};\n        this._init();\n    },\n    _init: function () {\n        var it = this, instData = it.model.get('instanceData'), reqParams = instData.requestParams || '';\n        if (reqParams[0] === '&') {\n            reqParams = reqParams.substr(1);\n        }\n        // try to load the Gogle Maps API once, otherwise conflicts will happen\n        const callback = () => {\n            it._showMap(it.model.get('id'), instData.latitude, instData.longitude, instData.zoom, instData.mapType, instData.markerList, instData.pathsList);\n        };\n\n        if (typeof google === 'undefined' || typeof google !== 'undefined' && typeof google.maps === 'undefined') {\n            if (!loadGoogleMapsPromise) {\n                loadGoogleMapsPromise = loadJsonp(`//maps.google.com/maps/api/js?${reqParams}`, 'callback');\n            }\n\n            loadGoogleMapsPromise.then(callback);\n        } else {\n            callback();\n        }\n    },\n    _configureImage: function (pk, pp, po) {\n        var width, height, originX, originY, anchorX, anchorY;\n        width = pp[pk + '.width'] ? parseInt(pp[pk + '.width']) : null;\n        height = pp[pk + '.height'] ? parseInt(pp[pk + '.height']) : null;\n        originX = pp[pk + '.origin.x'] ? parseInt(pp[pk + '.origin.x']) : 0;\n        originY = pp[pk + '.origin.y'] ? parseInt(pp[pk + '.origin.y']) : 0;\n        anchorX = pp[pk + '.anchor.x'] ? parseInt(pp[pk + '.anchor.x']) : 0;\n        anchorY = pp[pk + '.anchor.y'] ? parseInt(pp[pk + '.anchor.y']) : 0;\n        po[pk] = {\n            url: pp[pk + '.url'],\n            size: width && height ? new google.maps.Size(width, height) : null,\n            origin: new google.maps.Point(originX, originY),\n            anchor: new google.maps.Point(anchorX, anchorY)\n        };\n    },\n    _createInfo: function (pp) {\n        if (pp['infowindow.content'] && pp['infowindow.content'].length > 0) {\n            var gg = google.maps, po = { content: pp['infowindow.content'] };\n            if (pp['infowindow.pixelOffset'])\n                po['pixelOffset'] = pp['infowindow.pixelOffset'];\n            if (pp['infowindow.latitude'] && pp['infowindow.longitude'])\n                po['position'] = new gg.LatLng(pp['infowindow.latitude'], pp['infowindow.longitude']);\n            if (pp['infowindow.maxWidth'])\n                po['maxWidth'] = pp['infowindow.maxWidth'];\n            return new gg.InfoWindow(po);\n        }\n        return null;\n    },\n    _showMap: function (canvasId, latitude, longitude, zoom, mapType, markers, p) {\n        var it = this, gg = google.maps, myOptions = {\n                zoom: zoom,\n                center: new gg.LatLng(latitude, longitude),\n                mapTypeId: gg.MapTypeId[mapType],\n                autocloseinfo: true\n            },\n            container = it.$reportEl.find(\"#\" + canvasId),\n            map = new gg.Map(container[0], myOptions);\n        container.attr(\"js-stdnav\", \"false\");\n        if (markers) {\n            var j;\n            for (var i = 0; i < markers.length; i++) {\n                var markerProps = markers[i];\n                var markerLatLng = new gg.LatLng(markerProps['latitude'], markerProps['longitude']);\n                var markerOptions = {\n                    position: markerLatLng,\n                    map: map\n                };\n                if (markerProps['icon.url'] && markerProps['icon.url'].length > 0)\n                    it._configureImage('icon', markerProps, markerOptions);\n                else if (markerProps['icon'] && markerProps['icon'].length > 0)\n                    markerOptions['icon'] = markerProps['icon'];\n                else if (markerProps['color'] && markerProps['color'].length > 0)\n                    markerOptions['icon'] = 'http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=' + (markerProps['label'] && markerProps['label'].length > 0 ? markerProps['label'] : '%E2%80%A2') + '%7C' + markerProps['color'];\n                else if (markerProps['label'] && markerProps['label'].length > 0)\n                    markerOptions['icon'] = 'http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=' + markerProps['label'] + '%7CFE7569';\n                if (markerProps['shadow.url'] && markerProps['shadow.url'].length > 0)\n                    it._configureImage('shadow', markerProps, markerOptions);\n                for (j in markerProps) {\n                    if (j.indexOf('.') < 0 && markerProps.hasOwnProperty(j) && !markerOptions.hasOwnProperty(j))\n                        markerOptions[j] = markerProps[j];\n                }\n                var marker = new google.maps.Marker(markerOptions);\n                marker['info'] = it._createInfo(markerProps);\n                gg.event.addListener(marker, 'click', function () {\n                    if (map.autocloseinfo && it.infowindow && it.infowindow.close)\n                        it.infowindow.close();\n                    if (this['info']) {\n                        it.infowindow = this['info'];\n                        this['info'].open(map, this);\n                    } else if (this['url'] && this['url'].length > 0)\n                        window.open(this['url'], this['target']);\n                });\n            }\n        }\n        if (p) {\n            for (var k = 0; k < p.length; k++) {\n                var props = p[k], o = {}, l = [], isPoly = false;\n                for (var prop in props) {\n                    if (prop === 'locations' && props[prop]) {\n                        var loc = props[prop];\n                        for (let m = 0; m < loc.length; m++) {\n                            var latln = loc[m];\n                            l.push(new google.maps.LatLng(latln['latitude'], latln['longitude']));\n                        }\n                    } else if (prop === 'isPolygon') {\n                        isPoly = it._getBooleanValue(props[prop]);\n                    } else if (prop === 'visible' || prop === 'editable' || prop === 'clickable' || prop === 'draggable' || prop === 'geodesic') {\n                        o[prop] = it._getBooleanValue(props[prop]);\n                    } else {\n                        o[prop] = props[prop];\n                    }\n                }\n                o['map'] = map;\n                if (isPoly) {\n                    o['paths'] = l;\n                    new google.maps.Polygon(o);\n                } else {\n                    o['path'] = l;\n                    new google.maps.Polyline(o);\n                }\n            }\n        }\n    },\n    _getBooleanValue: function (v) {\n        return v === true || v === 'true';\n    }\n});","/*\n * Copyright (C) 2005 - 2022 TIBCO Software Inc. All rights reserved.\n * http://www.jaspersoft.com.\n *\n * Unless you have purchased a commercial license agreement from Jaspersoft,\n * the following license terms apply:\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n/*global document, process */\n\nconst LOAD_TIMEOUT_MILLIS = Number(process.env.SCRIPT_LOAD_TIMEOUT_SEC || 60) * 1000;\n\nconst urlCache = {};\n\nexport const loadScript = (url, {cache = true, prefix = '', scriptProps = {}} = {}) => {\n    const cacheKey = prefix + url;\n\n    // return promise for the cache\n    if (cache && urlCache[cacheKey]) {\n        return urlCache[cacheKey];\n    }\n\n    const result = new Promise(((resolve, reject) => {\n        const script = document.createElement('script');\n\n        const props = {\n            charset: 'utf-8',\n            timeout: LOAD_TIMEOUT_MILLIS,\n            ...scriptProps\n        }\n\n        Object.keys(props).forEach(p => script[p] = props[p]);\n\n        script.src = url;\n\n        const onScriptComplete = function () {\n            script.onerror = null;\n            script.onload = null;\n            clearTimeout(scriptTimeout);\n            resolve();\n        };\n\n        const onScriptError = function (...args) {\n            script.onerror = null;\n            script.onload = null;\n            clearTimeout(scriptTimeout);\n            reject(...args);\n        };\n\n        const scriptTimeout = setTimeout(function () {\n            onScriptError(new Error(`Load timeout for the script ${url}`));\n        }, props.timeout);\n\n        script.onerror = onScriptError\n        script.onload = onScriptComplete;\n\n        document.head.appendChild(script);\n    }))\n\n    urlCache[cacheKey] = result;\n\n    return result;\n}"],"sourceRoot":""}