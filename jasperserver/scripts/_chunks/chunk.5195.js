(self.webpackChunkjrs_ui=self.webpackChunkjrs_ui||[]).push([[5195],{95195:(e,t,i)=>{"use strict";i.r(t);var s=i(52499),a=i(72157),r=i.n(a),n=i(17620),o=i(64155),l=i(43852),d=i(97836),h=i.n(d),c=i(32758),u={CONTENT_REPOSITORY:"CONTENT_REPOSITORY",LOCAL:"LOCAL",NONE:"NONE",FILE_SYSTEM:"FILE_SYSTEM",LOCATE_EVENT:"resource:locate",ALLOWED_FILE_RESOURCE_EXTENSIONS:["css","ttf","jpg","jpeg","gif","bmp","png","jar","jrxml","properties","jrtx","xml","agxml","docx","doc","ppt","pptx","xls","xlsx","ods","odt","odp","pdf","rtf","html"],initialize:function(e){var t=function(e){return h().isObject(e)?e:r()("#"+e)[0]};this.resourceUri=t(e.resourceInput),this.browseButton=t(e.browseButton),this.filePath=t(e.fileUploadInput),this.fakeFilePath=t(e.fakeFileUploadInput),this.fakeFileInput=t(e.fakeFileUploadInputText),this.newResourceLink=t(e.newResourceLink);try{this._initFileSelector(e)}catch(e){}finally{this._initEvents(e)}return this},_initEvents:function(e){r()(document).on("click","#CONTENT_REPOSITORY, #FILE_SYSTEM, #NONE, #LOCAL",this._clickHandler),"fileResourceTreeDataProvider"===e.providerId&&(r()("#next").on("click",u._nextClickHandler),r()("#filePath").on("change",u._uploadChangeHandler))},_nextClickHandler:function(e){r()("#fileUpload").hasClass("error")&&e.preventDefault()},_uploadChangeHandler:function(e){r()("#fileUpload").removeClass("error");var t=!0;if(r()("#filePath")[0].value){var i=r()("#filePath")[0].value.match(/.*\.([^\.]+)$/);if(i){var s=i[1];h().indexOf(u.ALLOWED_FILE_RESOURCE_EXTENSIONS,s)<0&&(t=!1)}else t=!1}else t=!1;if(!t){var a=n.Z.messages["resource.report.unsupportedFileType.error"]+" "+u.ALLOWED_FILE_RESOURCE_EXTENSIONS.join(", ");r()("#fileUpload").addClass("error").find("span.warning").html(a)}},_clickHandler:function(e){u._updateResourceSelectorState(e.target.id)},_updateResourceSelectorState:function(e){n.Z.switchButtonState(this.filePath,e===this.FILE_SYSTEM),n.Z.switchButtonState(this.fakeFilePath,e===this.FILE_SYSTEM),n.Z.switchButtonState(this.fakeFileInput,e===this.FILE_SYSTEM),n.Z.switchButtonState(this.browseButton,e===this.CONTENT_REPOSITORY),n.Z.switchDisableState(this.resourceUri,e!==this.CONTENT_REPOSITORY);var t=e===this.LOCAL?["disabled","launcher"]:[];this._switchElementClasses(this.newResourceLink,t)},_initFileSelector:function(e){this.fileSelector=new c.Z.FileSelector(h().extend({},e,{uriTextboxId:this.resourceUri,browseButtonId:this.browseButton,title:e.dialogTitle}))},remove:function(e){this.fileSelector.remove()},_switchElementClasses:function(e,t){e&&t&&r()(e).removeClass(t[0]).addClass(t[1])}};const _=u;const p={PAGE_ID:"addResourceFile",TYPE_ID:"fileType",PATH_ID:"filePath",LABEL_ID:"addFileInputResourceLabelID",RESOURCE_ID_ID:"addFileInputResourceID",DESCRIPTION_ID:"addFileInputDescription",FOLDER_URI_ID:"folderUri",SAVE_BUTTON_ID:"save",typeToExtMap:{accessGrantSchema:["xml"],css:["css"],font:["ttf"],img:["jpg","jpeg","gif","bmp","png"],jar:["jar"],jrxml:["jrxml"],olapMondrianSchema:["xml"],prop:["properties"],jrtx:["jrtx"],xml:["xml","agxml"],config:["config"],cer:["p12","pfx"],contentResource:["docx","doc","ppt","pptx","xls","xlsx","ods","odt","odp","pdf","rtf","html","txt","csv","json"],secureFile:["*"],mongoDbSchema:["*"],key:["key"],pub:["pub"],ppk:["ppk"]},_canGenerateId:!0,initialize:function(e){this._form=r()("#"+this.PAGE_ID).find("form")[0],this._type=r()("#"+this.TYPE_ID)[0],this._path=r()("#"+this.PATH_ID)[0],this._label=r()("#"+this.LABEL_ID)[0],this._resourceId=r()("#"+this.RESOURCE_ID_ID)[0],this._description=r()("#"+this.DESCRIPTION_ID)[0],this._folderUri=r()("#"+this.FOLDER_URI_ID)[0],this._saveButton=r()("#"+this.SAVE_BUTTON_ID)[0],this._isEditMode=e.isEditMode,this._type.validationEntry={validator:this._typeValidator.bind(this),element:this._type,onValid:function(){if(!this._manual){var e=this._getFileNameFromPath(this._path.getValue());this._label.value=e,this._resourceId.readOnly||(this._resourceId.value=n.Z.generateResourceId(this._label.getValue()))}}.bind(this)},this._path.validator=this._pathValidator.bind(this),this._label.validator=n.Z.labelValidator.bind(this),this._resourceId.validator=n.Z.resourceIdValidator.bind(this),this._description.validator=n.Z.descriptionValidator.bind(this),_.initialize({resourceInput:"folderUri",browseButton:"browser_button",treeId:"addFileTreeRepoLocation",providerId:"repositoryExplorerTreeFoldersProvider",dialogTitle:n.Z.messages["resource.Add.Files.Title"]}),this._initEvents()},_initEvents:function(){r()(this._saveButton).on("click",function(e){this._isDataValid()||e.preventDefault()}.bindAsEventListener(this)),r()(this._type).on("change",function(e){this._validateTypeAndPath()}.bind(this)),r()(this._path).on("change",function(e){this._validateTypeAndPath()}.bind(this)),this._form&&new s.Form.Observer(this._form,.3,function(){this._folderUri.getValue().blank()?l.Z.disable("#save"):l.Z.enable("#save")}.bindAsEventListener(this)),r()(this._form).on("keyup",function(e){var t=e.target;[this._label,this._resourceId,this._description].include(t)&&(o.n4K.validate(n.Z.getValidationEntries([t])),t==this._resourceId&&this._resourceId.getValue()!=n.Z.generateResourceId(this._label.getValue())&&(this._canGenerateId=!1),t==this._label&&!this._isEditMode&&this._canGenerateId&&(this._resourceId.setValue(n.Z.generateResourceId(this._label.getValue())),o.n4K.validate(n.Z.getValidationEntries([this._resourceId])))),this._manual=!0}.bindAsEventListener(this)),r()(this._form).on("keydown",function(e){(0,o.BwZ)(e.target,["#"+this.DESCRIPTION_ID],!0)||13==e.keyCode&&this._saveButton.focus()}.bind(this))},_isDataValid:function(){var e=[this._label,this._resourceId,this._description,this._path,this._type];return o.n4K.validate(n.Z.getValidationEntries(e))},_validateTypeAndPath:function(){var e=[this._type,this._path];o.n4K.validate(n.Z.getValidationEntries(e))},_typeValidator:function(e){var t={isValid:!0,errorMessage:""},i=this._getExtension();return i.blank()||this.typeToExtMap[e]&&this.typeToExtMap[e].include("*")||this._getTypesForExtension(i).include(e)||(t.errorMessage=n.Z.messages.typeIsNotValid,t.isValid=!1),t},_pathValidator:function(e){var t=!0,i="";return!this._isEditMode&&e.blank()&&(i=n.Z.messages.pathIsEmpty,t=!1),{isValid:t,errorMessage:i}},_getTypesForExtension:function(e){var t=[];for(var i in this.typeToExtMap)this.typeToExtMap[i]&&this.typeToExtMap[i].include(e.toLowerCase())&&t.push(i);return t},_getExtension:function(){var e=this._path.getValue();if(e.blank())return"";var t=e.lastIndexOf(".");return-1==t?"":e.substr(t+1)},_getFileNameFromPath:function(e){var t=e.lastIndexOf("\\")>0?e.lastIndexOf("\\")+1:0;return e.substring(t,e.length)}};var E=i(71914),f=E.Z.addFileResource.localContext.initOptions;h().extend(window.localContext,E.Z.addFileResource.localContext),h().extend(n.Z.messages,E.Z.addFileResource.resource.messages),p.initialize(f),(0,o.zcy)()&&n.Z.initSwipeScroll()}}]);
//# sourceMappingURL=chunk.5195.js.map